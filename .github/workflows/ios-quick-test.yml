name: ğŸ§ª iOS Quick Test - IMMEDIATE

on:
  push:
    branches: [ main ]  # This will trigger immediately

env:
  FLUTTER_VERSION: '3.24.3'  # Stable version
  SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
  SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}

jobs:
  # ========== QUICK TEST ONLY ==========
  quick-test:
    name: ğŸ§ª Quick Dependencies Test
    runs-on: macos-latest
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
        
    - name: ğŸ› ï¸ Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: ${{ env.FLUTTER_VERSION }}
        cache: true
        
    - name: ğŸ”§ Flutter Doctor
      run: |
        flutter doctor -v
        dart --version
        
    - name: ğŸ“¦ Test Dependencies
      run: |
        echo "ğŸ” Testing dependency resolution..."
        flutter clean
        flutter pub get --verbose
        echo "âœ… Dependencies resolved successfully!"
        
    - name: ğŸ—ï¸ Test Build (No Codesign)
      run: |
        echo "ğŸ§ª Testing iOS build..."
        flutter build ios --release --no-codesign --dart-define=SUPABASE_URL="${{ env.SUPABASE_URL }}" --dart-define=SUPABASE_ANON_KEY="${{ env.SUPABASE_ANON_KEY }}"
        echo "âœ… Build test completed!"
        
    - name: ğŸ“Š Report Results
      run: |
        echo "ğŸ‰ QUICK TEST RESULTS:"
        echo "âœ… Flutter ${{ env.FLUTTER_VERSION }} works"
        echo "âœ… Dependencies resolved"
        echo "âœ… iOS build (no-codesign) successful"
        echo "ğŸš€ Ready for full workflow with certificates!"